<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发型工作室-客户服务结算</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/datatables/dataTables.bootstrap4.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../util/AdminLTE/dist/css/adminlte.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/iCheck/flat/blue.css">
    <!-- Morris chart -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/morris/morris.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- Date Picker -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/datepicker/datepicker3.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/daterangepicker/daterangepicker-bs3.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="../util/AdminLTE/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <!-- 主CSS -->
    <link rel="stylesheet" type="text/css" href="../util/css/main.css">
    <!-- 公共类CSS -->
    <link rel="stylesheet" type="text/css" href="../util/css/public.css">
</head>
<body>

<div class="wrapper">

    <!-- 头部 -->
    <nav class="main-header navbar navbar-expand bg-white navbar-light border-bottom">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a href="#" class="nav-link">Home</a>
            </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
            <!-- Notifications Dropdown Menu -->
            <li class="nav-item dropdown">
                <a class="nav-link" data-toggle="dropdown" href="#">
                    <i class="fa fa-user"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                    <span class="dropdown-item dropdown-header" >早上好，用户<span th:text="${managerNumber}"></span></span>
                    <div class="dropdown-divider"></div>
                    <a href="/login/cancellation" class="dropdown-item">
                        <i class="fa fa-sign-out"></i> 用户注销
                    </a>
                    <div class="dropdown-divider"></div>
						<a href="#" class="dropdown-item" data-toggle="modal"
							data-target="#changePassword"> <i class="fa fa-address-card"></i>
							修改密码
						</a>
					</div></li>
				<li class="nav-item"><a class="nav-link"
					data-widget="control-sidebar" data-slide="true" href="#"><i
						class="fa fa-th-large"></i></a></li>
			</ul>
		</nav>
		<!-- 修改密码遮罩层（模态框） -->
		<div class="modal fade" id="changePassword" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="card card-primary">
						<div class="card-header">
							<h3 class="card-title">修改密码</h3>
						</div>
						<!-- /.card-header -->
						<!-- form start -->
						<form class="form-horizontal" action="/login/changePassword" method="post" onsubmit="return changePassword()">
							<div class="card-body">
								<div class="form-group">
									<label for="inputPassword_old">旧密码</label>

									<div class="col-sm-10">
										<input type="password" class="form-control"
											id="password" name="password" placeholder="请输入当前密码">
									</div>
								</div>
								<div class="form-group">
									<label for="inputPassword_new">新密码</label>

									<div class="col-sm-10">
										<input type="password" class="form-control"
											id="newPassword_1" name="newPassword_1" placeholder="请输入新密码">
									</div>
								</div>
								<div class="form-group">
									<label for="inputPassword_conf" >确认密码</label>

									<div class="col-sm-10">
										<input type="password" class="form-control"
											id="newPassword_2" name="newPassword_2" placeholder="请确认新密码">
									</div>
								</div>
							</div>
							<!-- /.card-body -->
							<div class="modal-footer">
								<button type="button" class="btn btn-default"
									data-dismiss="modal">关闭</button>
								<button type="submit" class="btn btn-primary">提交更改</button>
							</div>
						</form>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
    <!-- 头部 -->

    <!-- 侧边栏 -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->
        <a href="index3.html" class="brand-link">
            <img src="../../util/AdminLTE/dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                 class="brand-image img-circle elevation-3"
                 style="opacity: .8">
            <span class="brand-text font-weight-light">雷格发型工作室</span>
        </a>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="../../util/AdminLTE/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                </div>
                <div class="info">
                    <a href="#" class="d-block">Alexander Pierce</a>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                    data-accordion="false">
                    <!-- Add icons to the links using the .nav-icon class
                         with font-awesome or any other icon font library -->
                    <li class="nav-header">客户</li>
                    <li class="nav-item">
                        <a href="/customer/" class="nav-link">
                            <i class="nav-icon fa fa-user"></i>
                            <p>
                                客户信息管理
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/payList/" class="nav-link">
                            <i class="nav-icon fa fa-credit-card"></i>
                            <p>
                                客户充值
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/record/" class="nav-link active">
                            <i class="nav-icon fa fa-bars"></i>
                            <p>
                                客户服务结算
                            </p>
                        </a>
                    </li>
                    <li class="nav-header">员工</li>
                    <li class="nav-item has-treeview menu-open">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fa fa-users"></i>
                            <p>
                                员工管理
                                <i class="right fa fa-angle-left"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="/employeeType/" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>员工类型管理</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/employeeManage/" class="nav-link">
                                    <i class="fa fa-circle-o nav-icon"></i>
                                    <p>员工信息管理</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-header">服务</li>
                    <li class="nav-item">
                        <a href="/serviceItem/" class="nav-link">
                            <i class="nav-icon fa fa-print"></i>
                            <p>
                                服务项目管理
                            </p>
                        </a>
                    </li>
                    <li class="nav-header">统计</li>
                    <li class="nav-item">
                        <a href="/count/salary" class="nav-link">
                            <i class="nav-icon fa fa-calendar"></i>
                            <p>
                                统计工资结算
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/count/statistics" class="nav-link">
                            <i class="nav-icon fa fa-usd"></i>
                            <p>
                                统计盈收
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/expense/" class="nav-link ">
                            <i class="nav-icon fa fa-usd"></i>
                            <p>
                                支出项目统计
                            </p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->
        </div>
        <!-- /.sidebar -->
    </aside>
    <!-- 侧边栏 -->

    <!-- 主体内容 -->
    <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>客户服务结算页面</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">客户</a></li>
                            <li class="breadcrumb-item active">客户服务结算</li>
                        </ol>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>

        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12" style="margin: 0 auto">
                        <!-- 提交服务项目表单 -->
                        <div class="card card-info">
                            <div class="card-header">
                                <h3 class="card-title">结算</h3>
                            </div>
                            <!-- /.card-header -->
                            <!-- form start -->
                             <form class="form-horizontal" onsubmit="return service()" action="/record/insertRecord" method="post">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-6">
                                            <div class="form-group">
                                                <label for="exampleInputPassword1">客户账户</label>
                                                <input type="text" class="form-control" name="username" id="username" placeholder="请输入客户账户">
                                            </div>
                                        </div>
                                        <span style="margin-top: 40px;color:red;" id="balance" th:text="${balance}">余额：0.00</span>
                                        <div class="col-12">
                                            <div class="form-group form-inline">
                                             <div class="col-12">
                                                <h6>服务项目选择：</h6>
                                                </div>
                                                <div class="col-12">
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-4 col-md-3" th:each=" psi : ${pageServiceItem}">
                                                        <div class="form-inline ">
                                                            <input name="serviceIemId" th:id="${psi.id}" type="checkbox"  th:value="${psi.id}" th:text="${psi.name}" onclick="check(this)">
                                                            <label class="form-check-label">(基础价格<span th:text="${psi.price}"></span>)</label>
                                                            <select  name="number" th:class="@{'select2 select2-hidden-accessible form-control '+${psi.id}}" tabindex="-1" aria-hidden="true" readonly>
                                                            <option  selected="selected" value=""> 没有该服务  </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                  </div>
                                                  </div>
                                                </div>
                                           </div>
                                    </div>
                                </div>
                                <!-- /.card-body -->

                                <div class="card-footer">
                                    <button type="submit" class="btn btn-info">提交结算</button><span th:text="${remind}" id="remind" style=" margin-left:10px; color:red;"></span>
                                    <span style="font-size: 20px; float: right;">(应付总金额)<span th:text="${sum}"></span>* (折扣)<span th:text="${discount}"></span>= (支付总金额)<span th:text="${sumPayavle}" ></span></span>
                                </div>
                            </form>
                        </div>
                        <!-- 提交服务项目表单 -->
                         <!-- 服务记录表单 -->
                        <div class="card">
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table style="min-width:500px;" id="form" class="table table-hover">
                                        <thead >
                                        <tr>
                                        <input id="user" type="text" class="form-control">
                                            <th>编号</th>
                                            <th>消费客户账户</th>
                                            <th>服务项目</th>
                                            <th>消费者姓名</th>
                                            <th>员工工号</th>
                                            <th>实付金额</th>
                                            <th>消费时间</th></tr>
                                        </thead>
                                        <tbody id = "myTable">
                                        <tr th:each="pr:${pageRecord}">
                                        <td></td>
                                        <td class="id" th:text="${pr.id}">1</td>
                                        <td th:text="${pr.username}">芬必得</td>
                                        <td th:text="${pr.serviceItem.name}">62284824886541125</td>
                                        <td th:text="${pr.customer.name}">王玉坤</td>
                                        <td th:text="${pr.number}">15724665148</td>
                                        <td th:text="${pr.payavle}">40</td>
                                        <td th:text="${pr.date}">2015-08-15</td></tr>
                                    <tr>
                                        </tbody>
                                    </table>
                                </div>
                         <div class="card-footer clearfix">
                            <ul class="pagination pagination-sm m-0 float-right" id="myButton">
                                <li class="page-item"><a class="page-link" th:href="@{'/record/?page=0'}">第一页</a></li>
                                <li class="page-item"><a class="page-link" th:if="${page}>0" th:href="@{'/record/?page='+${page-1}}">上一页</a></li>
                                <li class="page-item"><a class="page-link" style="cursor:default"><span th:text="${page+1}"></span> / <span th:text="${maxPage+1}"></span></a></li>
                                <li class="page-item"><a class="page-link" th:if="${page}<${maxPage}"  th:href="@{'/record/?page='+${page+1}}">下一页</a></li>
                                <li class="page-item"><a class="page-link" th:href="@{'/record/?page='+${maxPage}}">末页</a></li>
                            </ul>
                        </div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- 服务记录表单 -->
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- 主体内容 -->

    <!--底部版权信息-->
    <footer class="main-footer">
        <strong>Copyright &copy; 2018-05-03 <a href="https://coding.net/u/leige123321/p/HairCut/git?public=true">项目主页</a>.</strong>
        All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
            <b>雷格</b> 发型工作室
        </div>
    </footer>
    <!--底部版权信息-->

</div>

<!-- jQuery -->
<script src="../util/AdminLTE/plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
var is = 0 ;
function check(vi)//当选中时改变样式
{
is =1;
var name_1 = vi.value;
var conditions = vi.value;
if($("#"+name_1).is(':checked')){
	$("."+name_1).removeAttr("readonly");
}else{
	$("."+name_1).attr("readonly","readonly");
	$("."+name_1).val("");
}
$.ajax({  
    type: "post",  
    url: "/record/queryEmployee",  
    data:{conditions:conditions},  
    dataType: "json",  
    error: function(request) {  
    	
    },  
    success: function(data) {  
    	var myHtml = "";
    	for(var i = 0;i<data.length;i++){
    		if(i==0){myHtml = myHtml + "<option value=''>没有该服务</option>"}
    		myHtml = myHtml + "<option value='"+data[i].number+"'>"+data[i].number+"("+data[i].name+")"+"系数("+data[i].weighted+")</option>"
    	}
    	$("."+name_1).html(myHtml);
    }  
});  
}
function PageNext(a){//定义了2个参数a,b
	var len = $('table tr').length;
	var page = len * a;
    for(var i = 1;i<len;i++){
        $('table tr:eq('+i+') td:first').text(i+page);
    }
}
$(function () {
	var tableHtml = $("#myTable").html();
	var buttonHtml = $("#myButton").html();
	$('#username').keyup(function(){
		 var conditions1=$(this).val(); 
		 if(conditions1!=''){
			 $.ajax({  
	                type: "post",  
	                url: "/record/balance",  
	                data:{conditions:conditions1},  
	                dataType: "json",  
	                error: function(request) {  
	                	$('#balance').text("没有该用户");
	                },  
	                success: function(data) {  
	                	$('#balance').text("余额："+ data);
	                }  
	            });   
	        }else{
	        	$('#balance').text("余额：0.00");
	        }   
	})
	$('#user').keyup(function() {  
       	$("#myTable").html("");
        var conditions=$(this).val();  
        if(conditions!=''){  
            $.ajax({  
                type: "post",  
                url: "/record/query",  
                data:{conditions:conditions},  
                dataType: "json",  
                error: function(request) {  
                    alert("Connection error:"+request.error);  
                },  
                success: function(data) {  
                	var myHtml = "";
                	var myhtmltd = "";
                	for(var i = 0;i<data.length;i++){
                   		myhtmltd ="<td></td><td class='id'>"+data[i].id+"</td><td>"+
                   		data[i].userName+"</td><td>"+
                   		data[i].siName+"</td><td>"+
                   		data[i].cName+"</td><td>"+
                   		data[i].number+"</td><td>"+
                   		data[i].payavle+"</td><td>"+
                   		data[i].date+"</td>";
                   		myHtml=myHtml+"<tr>"+myhtmltd+"</tr>";
                    	  //循环数据追加到 myHtml
                    	}
                    	myHtml=myHtml;
                    	 $("#myTable").html(myHtml);
                    	 $("#myButton").html("");
                    	 nameId();
                }  
            });   
        }else{  
        $("#myTable").html(tableHtml);
       	$("#myButton").html(buttonHtml);
       	nameId();
        }  
    });  
	 //$('table tr:not(:first)').remove();
    var len = $('table tr').length;
    for(var i = 1;i<len;i++){
        $('table tr:eq('+i+') td:first').text(i);
    }
	$(".id").hide();
        $('#form').DataTable({
            "paging": false,
            "lengthChange": false,
            "searching": false,
            "ordering": false,
            "info": false,
            "autoWidth": false
        });
    });
    $.widget.bridge('uibutton', $.ui.button)
    //修改密码表单验证
    function service(){
    	var flag = false;

        //多选框确认
        $('input:checkbox').each(function() {
            if ($(this).get(0).checked) {
                flag = true;
            }else{
            	if( is == 0){
                $("#remind").text('请至少选择一个服务项目');}
            } 

        });
        is=0;
    	return flag;
    }
    function changePassword() {
        var oldPassword = document.getElementById('password').value;
        var newPassword_1 = document.getElementById('newPassword_1').value;
        var newPassword_2 = document.getElementById('newPassword_2').value;
        if (oldPassword == ""){
            document.getElementById("span_password").innerHTML='请输入当前密码';
            return false;
        }else if (newPassword_1 == ""){
            document.getElementById("span_password").innerHTML='请输入新密码';
            return false;
        }else if (newPassword_2 == ""){
            document.getElementById("span_password").innerHTML='请输入确认密码';
            return false;
        }else if (newPassword_1 != newPassword_2){
            document.getElementById("span_password").innerHTML='新密码和确认密码不一致';
            return false;
        }
        return true;
    }
    function nameId() {
		 //$('table tr:not(:first)').remove();
	    var len = $('table tr').length;
	    for(var i = 1;i<len;i++){
	        $('table tr:eq('+i+') td:first').text(i);
	    }
		$(".id").hide();
}
</script>
<!-- Bootstrap 4 -->
<script src="../util/AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables -->
<script src="../util/AdminLTE/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../util/AdminLTE/plugins/datatables/dataTables.bootstrap4.min.js"></script>
<!-- Morris.js charts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="../util/AdminLTE/plugins/morris/morris.min.js"></script>
<!-- Sparkline -->
<script src="../util/AdminLTE/plugins/sparkline/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="../util/AdminLTE/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="../util/AdminLTE/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script src="../util/AdminLTE/plugins/knob/jquery.knob.js"></script>
<!-- daterangepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script src="../util/AdminLTE/plugins/daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="../util/AdminLTE/plugins/datepicker/bootstrap-datepicker.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="../util/AdminLTE/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="../util/AdminLTE/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../util/AdminLTE/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../util/AdminLTE/dist/js/adminlte.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="../util/AdminLTE/dist/js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../util/AdminLTE/dist/js/demo.js"></script>
</body>
</html>